(this["webpackJsonplite-low-code"]=this["webpackJsonplite-low-code"]||[]).push([[0],{34:function(e,t,n){},35:function(e,t,n){"use strict";n.r(t);var c=n(7),r=n(1),a=n.n(r),i=n(8),o=n.n(i),s=(n(29),n(16)),u=n.n(s),l=n(4),d=n(17),j=n.n(d),b=n(6),v=new Map;function f(e,t){var n=e.type;if(v.has(n))throw new Error("type ".concat(n," already registered."));return v.set(n,t),t}function h(e){var t=Object(r.useCallback)((function(n){if(Array.isArray(n))return(null===e||void 0===e?void 0:e.batchRender)?e.batchRender(c,n):n.map(c);function c(e){var n,c=e&&(n=e.type,v.get(n));return c?a.a.createElement(c,Object(b.a)(Object(b.a)({key:e.id},e),{},{render:t})):a.a.createElement("div",null,"[Type] "+(null===e||void 0===e?void 0:e.type)+" \u672a\u6ce8\u518c")}return c(n)}),[e]);return t}function m(e){var t=e.schema,n=h(e.enhance);return t?n(t):null}globalThis._debug={compRegisteredMap:v};var O=n(0);var p=function(e){var t=e.columns,n=e.render,c=e.id;return Object(O.jsx)("div",{className:"flex-row",children:t.map((function(e,t){return Object(O.jsx)("div",{className:"flex-auto",children:n(e)},c+"_"+t)}))})};var g=function(e){var t=e.tpl;return Object(O.jsx)("div",{children:t})};var y=function(e){var t=e.label;return Object(O.jsxs)("div",{children:[Object(O.jsx)("label",{children:t}),Object(O.jsx)("input",{className:"u-full-width"})]})};f({type:"page"},(function(e){var t=e.body,n=e.render;return Object(O.jsx)("div",{className:"page",children:n(t)})})),f({type:"columns"},p),f({type:"tpl"},g),f({type:"input"},y);var x=n(18),w=n.n(x),S=n(19),N=(n(32),new S.a({position:{x:"right",y:"top"}})),k={get:function(e,t){try{return JSON.parse(e).value}catch(n){return t}},set:function(e){return JSON.stringify({value:e})}},I=new w.a("lc-",k);var A=function(){var e=Object(r.useRef)(null),t=Object(r.useState)(I.get("schema",{type:"page"})),n=Object(l.a)(t,2),c=n[0],a=n[1];return Object(r.useEffect)((function(){e.current||(e.current=new j.a(document.getElementById("jsoneditor"),{mode:"code",modes:["code","tree","view"]}),e.current.set(c))}),[]),Object(O.jsxs)("div",{className:"App row full-height",children:[Object(O.jsx)("div",{children:Object(O.jsx)(m,{schema:c})}),Object(O.jsx)("hr",{}),Object(O.jsx)("h4",{children:"Schema \u7f16\u8f91\u5668"}),Object(O.jsxs)("div",{children:[Object(O.jsxs)("div",{className:"row",children:[Object(O.jsx)("button",{className:"button button-primary",onClick:function(){var t=e.current.get();t&&(a(e.current.get()),I.set("schema",t))},children:"save"}),Object(O.jsx)("button",{className:"button",onClick:function(){a({type:"page"}),e.current.set({type:"page"})},children:"reset"})]}),Object(O.jsx)("div",{id:"jsoneditor"})]})]})},C=n(10),W=n(20),E=n(21),L=n(3),R=n(9),M=Object(R.a)("schema"),B=Object(R.a)("activeWidgetIdListeners"),P=Object(R.a)("widgetSchemaListenersMap"),_=Object(R.a)("activeWidgetId"),D=function(){function e(t){Object(W.a)(this,e),Object.defineProperty(this,M,{writable:!0,value:null}),Object.defineProperty(this,B,{writable:!0,value:new Set}),Object.defineProperty(this,P,{writable:!0,value:new Map}),Object.defineProperty(this,_,{writable:!0,value:null}),Object(L.a)(this,M)[M]=t}return Object(E.a)(e,[{key:"onWidgetSchemaChange",value:function(e,t){var n=Object(L.a)(this,P)[P].get(e);return n||(n=new Set,Object(L.a)(this,P)[P].set(e,n)),n.has(t)||n.add(t),function(){return n.delete(t)}}},{key:"updateActiveWidgetSchema",value:function(e){if(Object(L.a)(this,P)[P].has(e.id)){var t,n=Object(c.a)(Object(L.a)(this,P)[P].get(e.id).values());try{for(n.s();!(t=n.n()).done;){t.value.call(null,e)}}catch(r){n.e(r)}finally{n.f()}}}},{key:"setActiveWidgetId",value:function(e){Object(L.a)(this,_)[_]=e;var t,n=Object(c.a)(Object(L.a)(this,B)[B].values());try{for(n.s();!(t=n.n()).done;){t.value.call(null,Object(L.a)(this,_)[_])}}catch(r){n.e(r)}finally{n.f()}}},{key:"onAcitiveWidgetIdChange",value:function(e){var t=this;return Object(L.a)(this,B)[B].has(e)||Object(L.a)(this,B)[B].add(e),function(){return Object(L.a)(t,B)[B].delete(e)}}},{key:"getActiveWidget",value:function(){return T(Object(L.a)(this,M)[M],Object(L.a)(this,_)[_])}},{key:"getSchema",value:function(){return Object(L.a)(this,M)[M]}}]),e}(),J=Object(r.createContext)(new D);function T(e,t){if((null===e||void 0===e?void 0:e.id)===t)return e;for(var n=0,c=Object.keys(e);n<c.length;n++){var r=c[n];if("object"===typeof e[r]){var a=T(e[r],t);if(a)return a}}return null}function H(e,t,n){var c=0===n?e.children[0]:e.children[n-1].nextSibling;e.insertBefore(t,c)}function q(e){var t=e.schema,n=e.render,c=Object(r.useContext)(J),a=Object(r.useState)({}),i=Object(l.a)(a,2)[1];return Object(r.useEffect)((function(){return c.onWidgetSchemaChange(t.id,(function(e){Object.assign(t,e),i({})}))}),[c,t]),Object(O.jsx)("div",{className:"drag-drop-item",onClick:function(e){e.stopPropagation(),c.setActiveWidgetId(t.id)},children:n(t)},t.id)}var z=function(e){var t=e.render,n=e.schema,c=Object(r.useRef)(null),a=Object(r.useState)({}),i=Object(l.a)(a,2)[1],o=Object(r.useContext)(J);return Object(r.useEffect)((function(){var e=new C.a(c.current,{group:{name:"low-code",pull:!0,put:!0},sort:!0,onAdd:function(e){e.item.remove(),n.splice(e.newIndex,0,e.item._dragData),o.setActiveWidgetId(e.item._dragData.id),i({})},onUpdate:function(e){e.item.remove(),H(e.from,e.item,e.oldIndex),n.splice(e.newIndex,0,n.splice(e.oldIndex,1)[0]),i({})},onRemove:function(e){H(c.current,e.item,e.oldIndex),n.splice(e.oldIndex,1),i({})},onStart:function(e){var t=Array.prototype.slice.call(c.current.childNodes).indexOf(e.item),r=n[t];e.item._dragData=r},onMove:function(e){}});return function(){return e.destroy()}}),[n,o]),Object(O.jsx)("div",{className:"drag-drop-zone",ref:c,children:n.map((function(e){return Object(O.jsx)(q,{schema:e,render:t},e.id)}))})};var F=function(e){var t=e.schema;return Object(O.jsx)("div",{className:"canvas-panel eight columns",children:Object(O.jsx)(m,{schema:t,enhance:{batchRender:function(e,t){return Object(O.jsx)(z,{schema:t,render:e})}}})})};var U=function(e){e.compositionList;var t=Object(r.useContext)(J),n=Object(r.useState)(t.getActiveWidget()),c=Object(l.a)(n,2),a=c[0],i=c[1];return Object(r.useEffect)((function(){return t.onAcitiveWidgetIdChange((function(){i(t.getActiveWidget())}))}),[t]),Object(O.jsx)("div",{className:"two columns",children:(null===a||void 0===a?void 0:a.label)&&Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)("label",{children:"label"}),Object(O.jsx)("input",{defaultValue:a.label,onChange:function(e){return t.updateActiveWidgetSchema(Object(b.a)(Object(b.a)({},a),{},{label:e.target.value}))}})]})},null===a||void 0===a?void 0:a.id)},V=n(37),G=n(24);var K=function(e){var t=e.compositionList,n=void 0===t?[]:t,c=Object(r.useRef)(null);return Object(r.useEffect)((function(){var e=new C.a(c.current,{group:{name:"low-code",pull:"clone",put:!1},sort:!1,onClone:function(e){var t=Array.prototype.slice.call(c.current.childNodes).indexOf(e.item),r=n[t];e.item._dragData=Object(V.a)(Object(b.a)(Object(b.a)({},r.schema),{},{key:r.key,id:Object(G.a)(10)}))}});return function(){return e.destroy()}}),[n]),Object(O.jsx)("div",{ref:c,className:"two columns select-panel",children:n.map((function(e){return Object(O.jsx)("p",{className:"drag-item",children:e.name},e.name)}))})};n(34);function Q(e,t){var n=e.compositionList,c=e.schema,a=void 0===c?{type:"page",body:[]}:c,i=Object(r.useMemo)((function(){return new D(a)}),[a]);return Object(r.useImperativeHandle)(t,(function(){return{getSchema:function(){return i.getSchema()}}})),Object(O.jsx)("div",{className:"editor row",children:Object(O.jsxs)(J.Provider,{value:i,children:[Object(O.jsx)(K,{compositionList:n}),Object(O.jsx)(F,{schema:a}),Object(O.jsx)(U,{compositionList:n})]})})}var X=Object(r.forwardRef)(Q);var Y=function(){var e=Object(r.useRef)(null),t=Object(r.useState)(I.get("schema",{type:"page",body:[]})),n=Object(l.a)(t,2),c=n[0],a=n[1];return Object(O.jsxs)("div",{className:"full-height flex-column",children:[Object(O.jsxs)("div",{className:"row ",children:[Object(O.jsx)("button",{onClick:function(){var t=e.current.getSchema();t&&(I.set("schema",t),N.success("Save Success!"))},className:"button button-primary",children:"Save Schema"}),Object(O.jsx)("button",{onClick:function(){a({type:"page",body:[]})},className:"button",children:"clear Schema"})]}),Object(O.jsxs)("div",{className:"flex-auto",children:[Object(O.jsx)(X,{ref:e,schema:c,compositionList:[{name:"Single Line Input",key:"text-input",schema:{type:"input",label:"Single Line Input"}},{name:"Columns",key:"columns",schema:{type:"columns",columns:[[],[]]}},{name:"Template",key:"template",schema:{type:"tpl",tpl:"Hello World"}}]}),";"]})]})};new u.a("/",{hash:!0}).hooks({after:function(e){var t,n=document.querySelectorAll("body > nav > a"),r=Object(c.a)(n);try{for(r.s();!(t=r.n()).done;){var a=t.value;a.classList.remove("active"),a.getAttribute("href").indexOf(e.url)>-1&&a.classList.add("active")}}catch(i){r.e(i)}finally{r.f()}}}).on("/editor",(function(){o.a.render(Object(O.jsx)(a.a.StrictMode,{children:Object(O.jsx)(Y,{})}),document.getElementById("root"))}),{leave:function(e){o.a.render(null,document.getElementById("root")),e()}}).on("/render",(function(){o.a.render(Object(O.jsx)(a.a.StrictMode,{children:Object(O.jsx)(A,{})}),document.getElementById("root"))}),{leave:function(e){o.a.render(null,document.getElementById("root")),e()}}).resolve()}},[[35,1,2]]]);
//# sourceMappingURL=main.a62d1fa0.chunk.js.map